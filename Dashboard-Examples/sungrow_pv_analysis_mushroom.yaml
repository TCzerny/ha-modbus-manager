title: Sungrow PV Analysis (Mushroom)
path: pv-analysis-mushroom
icon: mdi:solar-power
panel: false
type: dashboard

# IMPORTANT: Replace {PREFIX} with your actual device prefix (e.g., SG)
# Example: sensor.{PREFIX}_total_dc_power becomes sensor.SG_total_dc_power
# This version uses Mushroom Cards with the new Sections layout
# Requires: Mushroom Cards (HACS) - https://github.com/piitaya/lovelace-mushroom

views:
  - title: PV Overview
    path: overview
    icon: mdi:view-dashboard
    type: sections
    sections:
      - title: PV Generation
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_total_dc_power
            name: Total DC Power
            icon: mdi:lightning-bolt
            icon_color: |
              [[[
                const power = entity.state;
                if (power > 5000) return 'green';
                if (power > 2000) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            fill_container: true
            primary_info: state
            secondary_info: last-updated

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_daily_pv_generation
            name: Daily PV Generation
            icon: mdi:solar-power
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_total_pv_generation
            name: Total PV Generation
            icon: mdi:solar-power
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_inverter_temperature
            name: Inverter Temperature
            icon: mdi:thermometer
            icon_color: |
              [[[
                const temp = entity.state;
                if (temp > 60) return 'red';
                if (temp > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: MPPT Trackers
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt1_voltage
            name: MPPT1 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt1_current
            name: MPPT1 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt2_voltage
            name: MPPT2 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt2_current
            name: MPPT2 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt3_voltage
            name: MPPT3 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt3_current
            name: MPPT3 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt4_voltage
            name: MPPT4 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt4_current
            name: MPPT4 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: AC Output
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_a_voltage
            name: Phase A Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_a_current
            name: Phase A Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_a_power
            name: Phase A Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_b_voltage
            name: Phase B Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_b_current
            name: Phase B Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_b_power
            name: Phase B Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_c_voltage
            name: Phase C Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_c_current
            name: Phase C Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_phase_c_power
            name: Phase C Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: Performance Metrics
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_self_consumption_rate
            name: Self-Consumption Rate
            icon: mdi:home-lightning-bolt
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 70) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_autarky_rate
            name: Autarky Rate
            icon: mdi:power-plug-off
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 80) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_dc_to_ac_efficiency
            name: DC to AC Efficiency
            icon: mdi:gauge
            icon_color: |
              [[[
                const eff = entity.state;
                if (eff > 95) return 'green';
                if (eff > 90) return 'orange';
                return 'red';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_capacity_factor
            name: PV Capacity Factor
            icon: mdi:percent
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: PV Generation History
        cards:
          - type: history-graph
            title: PV Generation (24h)
            entities:
              - entity: sensor.{PREFIX}_total_dc_power
                name: Total DC Power
              - entity: sensor.{PREFIX}_daily_pv_generation
                name: Daily PV Generation
            hours_to_show: 24
            refresh_interval: 60

          - type: history-graph
            title: Inverter Temperature (24h)
            entities:
              - entity: sensor.{PREFIX}_inverter_temperature
                name: Inverter Temperature
            hours_to_show: 24
            refresh_interval: 60

  - title: MPPT Analysis
    path: mppt
    icon: mdi:chart-line
    type: sections
    sections:
      - title: MPPT Voltages
        cards:
          - type: history-graph
            title: MPPT Voltages (24h)
            entities:
              - entity: sensor.{PREFIX}_mppt1_voltage
                name: MPPT1 Voltage
              - entity: sensor.{PREFIX}_mppt2_voltage
                name: MPPT2 Voltage
              - entity: sensor.{PREFIX}_mppt3_voltage
                name: MPPT3 Voltage
              - entity: sensor.{PREFIX}_mppt4_voltage
                name: MPPT4 Voltage
            hours_to_show: 24
            refresh_interval: 60

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt1_voltage
            name: MPPT1 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt2_voltage
            name: MPPT2 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt3_voltage
            name: MPPT3 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt4_voltage
            name: MPPT4 Voltage
            icon: mdi:lightning-bolt
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: MPPT Currents
        cards:
          - type: history-graph
            title: MPPT Currents (24h)
            entities:
              - entity: sensor.{PREFIX}_mppt1_current
                name: MPPT1 Current
              - entity: sensor.{PREFIX}_mppt2_current
                name: MPPT2 Current
              - entity: sensor.{PREFIX}_mppt3_current
                name: MPPT3 Current
              - entity: sensor.{PREFIX}_mppt4_current
                name: MPPT4 Current
            hours_to_show: 24
            refresh_interval: 60

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt1_current
            name: MPPT1 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt2_current
            name: MPPT2 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt3_current
            name: MPPT3 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt4_current
            name: MPPT4 Current
            icon: mdi:current-ac
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

      - title: MPPT Power Analysis
        cards:
          - type: history-graph
            title: MPPT Power (24h)
            entities:
              - entity: sensor.{PREFIX}_mppt1_power
                name: MPPT1 Power
              - entity: sensor.{PREFIX}_mppt2_power
                name: MPPT2 Power
              - entity: sensor.{PREFIX}_mppt3_power
                name: MPPT3 Power
              - entity: sensor.{PREFIX}_mppt4_power
                name: MPPT4 Power
            hours_to_show: 24
            refresh_interval: 60

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt1_power
            name: MPPT1 Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt2_power
            name: MPPT2 Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt3_power
            name: MPPT3 Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt4_power
            name: MPPT4 Power
            icon: mdi:flash
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_total_mppt_power
            name: Total MPPT Power
            icon: mdi:flash-circle
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt_power_deviation
            name: MPPT Deviation from Average
            icon: mdi:chart-line-variant
            icon_color: |
              [[[
                const dev = entity.state;
                if (dev > 100) return 'red';
                if (dev > 50) return 'orange';
                return 'green';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt_balance
            name: MPPT Balance
            icon: mdi:scale-balance
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_active_mppt_count
            name: Active MPPTs
            icon: mdi:counter
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: statistics-graph
            title: MPPT Voltage Statistics (30 days)
            entities:
              - entity: sensor.{PREFIX}_mppt1_voltage
                name: MPPT1 Voltage
              - entity: sensor.{PREFIX}_mppt2_voltage
                name: MPPT2 Voltage
            days_to_show: 30
            chart_type: line
            stat_types:
              - min
              - max
              - mean

          - type: statistics-graph
            title: MPPT Current Statistics (30 days)
            entities:
              - entity: sensor.{PREFIX}_mppt1_current
                name: MPPT1 Current
              - entity: sensor.{PREFIX}_mppt2_current
                name: MPPT2 Current
            days_to_show: 30
            chart_type: line
            stat_types:
              - min
              - max
              - mean

  - title: Energy Flow Analysis
    path: energy-flow
    icon: mdi:transit-connection-variant
    type: sections
    sections:
      - title: Energy Flow
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_to_load_direct
            name: PV to Load Direct
            icon: mdi:solar-power
            icon_color: green
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_to_battery
            name: PV to Battery
            icon: mdi:battery-charging
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_battery_to_load
            name: Battery to Load
            icon: mdi:battery
            icon_color: orange
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_to_grid
            name: PV to Grid
            icon: mdi:transmission-tower-export
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_battery_to_grid
            name: Battery to Grid
            icon: mdi:transmission-tower-export
            icon_color: amber
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_grid_to_load
            name: Grid to Load
            icon: mdi:transmission-tower
            icon_color: red
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_grid_to_battery
            name: Grid to Battery
            icon: mdi:battery-charging
            icon_color: indigo
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_net_consumption
            name: Net Consumption
            icon: mdi:flash
            icon_color: |
              [[[
                const consumption = entity.state;
                if (consumption > 1000) return 'red';
                if (consumption > 500) return 'orange';
                return 'green';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: history-graph
            title: Energy Flow (24h)
            entities:
              - entity: sensor.{PREFIX}_pv_to_load_direct
                name: PV to Load Direct
              - entity: sensor.{PREFIX}_pv_to_battery
                name: PV to Battery
              - entity: sensor.{PREFIX}_pv_to_grid
                name: PV to Grid
              - entity: sensor.{PREFIX}_battery_to_load
                name: Battery to Load
              - entity: sensor.{PREFIX}_battery_to_grid
                name: Battery to Grid
              - entity: sensor.{PREFIX}_grid_to_load
                name: Grid to Load
              - entity: sensor.{PREFIX}_grid_to_battery
                name: Grid to Battery
            hours_to_show: 24
            refresh_interval: 60

      - title: Self-Consumption & Autarky
        cards:
          # 1. Current (real-time)
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_self_consumption_rate
            name: Self-Consumption (Current)
            icon: mdi:home-lightning-bolt
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 70) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            fill_container: true
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_autarky_rate
            name: Autarky (Current)
            icon: mdi:power-plug-off
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 80) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            fill_container: true
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_grid_dependency
            name: Grid Dependency
            icon: mdi:transmission-tower
            icon_color: |
              [[[
                const dep = entity.state;
                if (dep > 50) return 'red';
                if (dep > 20) return 'orange';
                return 'green';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          # 2. Today (daily)
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_self_consumption_rate_today
            name: Self-Consumption Today
            icon: mdi:home-lightning-bolt
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 70) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            fill_container: true
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_autarky_rate_today
            name: Autarky Today
            icon: mdi:power-plug-off
            icon_color: |
              [[[
                const rate = entity.state;
                if (rate > 80) return 'green';
                if (rate > 50) return 'orange';
                return 'blue';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            fill_container: true
            primary_info: state
            secondary_info: name

          # 3. Historical chart (30 days, Grafana-style)
          - type: statistics-graph
            title: Self-Consumption & Autarky (30 days)
            entities:
              - entity: sensor.{PREFIX}_self_consumption_rate
                name: Self-Consumption Rate
              - entity: sensor.{PREFIX}_autarky_rate
                name: Autarky Rate
            days_to_show: 30
            chart_type: bar
            period: day
            stat_types:
              - mean

  - title: Statistics
    path: statistics
    icon: mdi:chart-box-outline
    type: sections
    sections:
      - title: PV Generation Statistics
        cards:
          - type: statistics-graph
            title: Daily PV Generation (30 days)
            entities:
              - entity: sensor.{PREFIX}_daily_pv_generation
                name: Daily PV Generation
            days_to_show: 30
            chart_type: bar
            stat_types:
              - state

          - type: statistics-graph
            title: Total PV Generation Statistics (30 days)
            entities:
              - entity: sensor.{PREFIX}_total_pv_generation
                name: Total PV Generation
            days_to_show: 30
            chart_type: line
            stat_types:
              - min
              - max
              - mean

          - type: history-graph
            title: PV Generation Trend (7 days)
            entities:
              - entity: sensor.{PREFIX}_daily_pv_generation
                name: Daily PV Generation
            hours_to_show: 168
            refresh_interval: 3600

      - title: Power Statistics
        cards:
          - type: statistics-graph
            title: Total DC Power Statistics (30 days)
            entities:
              - entity: sensor.{PREFIX}_total_dc_power
                name: Total DC Power
            days_to_show: 30
            chart_type: line
            stat_types:
              - min
              - max
              - mean

          - type: history-graph
            title: Power Distribution (24h)
            entities:
              - entity: sensor.{PREFIX}_total_dc_power
                name: Total DC Power
              - entity: sensor.{PREFIX}_phase_a_power
                name: Phase A Power
              - entity: sensor.{PREFIX}_phase_b_power
                name: Phase B Power
              - entity: sensor.{PREFIX}_phase_c_power
                name: Phase C Power
            hours_to_show: 24
            refresh_interval: 60

      - title: Temperature Statistics
        cards:
          - type: statistics-graph
            title: Inverter Temperature Statistics (30 days)
            entities:
              - entity: sensor.{PREFIX}_inverter_temperature
                name: Inverter Temperature
            days_to_show: 30
            chart_type: line
            stat_types:
              - min
              - max
              - mean

          - type: history-graph
            title: Inverter Temperature Trend (7 days)
            entities:
              - entity: sensor.{PREFIX}_inverter_temperature
                name: Inverter Temperature
            hours_to_show: 168
            refresh_interval: 3600

      - title: Performance Metrics
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_dc_to_ac_efficiency
            name: DC to AC Efficiency
            icon: mdi:gauge
            icon_color: |
              [[[
                const eff = entity.state;
                if (eff > 95) return 'green';
                if (eff > 90) return 'orange';
                return 'red';
              ]]]
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_capacity_factor
            name: PV Capacity Factor
            icon: mdi:percent
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_mppt_balance
            name: MPPT Balance
            icon: mdi:scale-balance
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_active_mppt_count
            name: Active MPPTs
            icon: mdi:counter
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: custom:mushroom-entity-card
            entity: sensor.{PREFIX}_pv_generation_hours_today
            name: PV Generation Hours Today
            icon: mdi:clock-outline
            icon_color: blue
            tap_action:
              action: more-info
            layout: vertical
            primary_info: state
            secondary_info: name

          - type: history-graph
            title: Efficiency Metrics (24h)
            entities:
              - entity: sensor.{PREFIX}_dc_to_ac_efficiency
                name: DC to AC Efficiency
              - entity: sensor.{PREFIX}_self_consumption_rate
                name: Self-Consumption Rate
            hours_to_show: 24
            refresh_interval: 60

  - title: EMS Control
    path: ems-control
    icon: mdi:cog
    type: sections
    sections:
      - title: Mode Settings
        cards:
          - type: entities
            title: Energy Management
            show_header_toggle: false
            entities:
              - entity: select.{PREFIX}_ems_mode_selection
                name: EMS Mode
                icon: mdi:state-machine
              - entity: select.{PREFIX}_inverter_run_mode
                name: Inverter Run Mode
                icon: mdi:power
              - entity: select.{PREFIX}_load_adjustment_mode_selection
                name: Load Adjustment Mode
                icon: mdi:clock-outline
              - entity: select.{PREFIX}_load_adjustment_mode_on_off_selection
                name: Load ON/OFF
                icon: mdi:toggle-switch

      - title: Battery Control
        cards:
          - type: entities
            title: SoC & Backup
            show_header_toggle: false
            entities:
              - entity: number.{PREFIX}_min_soc
                name: Min SoC
                icon: mdi:battery-arrow-down
              - entity: number.{PREFIX}_max_soc
                name: Max SoC
                icon: mdi:battery-arrow-up
              - entity: number.{PREFIX}_reserved_soc_for_backup
                name: Reserved SoC for Backup
                icon: mdi:battery-backup
              - entity: select.{PREFIX}_backup_mode
                name: Backup Mode
                icon: mdi:backup-restore

          - type: entities
            title: Battery Power Limits
            show_header_toggle: false
            entities:
              - entity: number.{PREFIX}_battery_max_charging_power
                name: Max Charging Power
                icon: mdi:battery-charging
              - entity: number.{PREFIX}_battery_max_discharging_power
                name: Max Discharging Power
                icon: mdi:battery-charging-high

          - type: entities
            title: Forced Charge/Discharge
            show_header_toggle: false
            entities:
              - entity: select.{PREFIX}_battery_forced_charge_discharge_cmd
                name: Forced Cmd
                icon: mdi:battery-sync
              - entity: number.{PREFIX}_battery_forced_charge_discharge_power
                name: Forced Power
                icon: mdi:flash

      - title: Export & Power Limit
        cards:
          - type: entities
            title: Export Control
            show_header_toggle: false
            entities:
              - entity: select.{PREFIX}_export_power_limit_mode
                name: Export Limit Mode
                icon: mdi:transmission-tower-export
              - entity: number.{PREFIX}_export_power_limit
                name: Export Power Limit
                icon: mdi:gauge
              - entity: number.{PREFIX}_export_power_limit_ratio
                name: Export Limit Ratio %
                icon: mdi:percent

      - title: Advanced Controls
        cards:
          - type: entities
            title: Power & PV Limitation
            show_header_toggle: false
            entities:
              - entity: select.{PREFIX}_active_power_limitation
                name: Active Power Limitation
                icon: mdi:flash-off
              - entity: number.{PREFIX}_active_power_limit_ratio
                name: Active Power Limit Ratio %
                icon: mdi:percent
              - entity: select.{PREFIX}_pv_power_limitation
                name: PV Power Limitation
                icon: mdi:solar-power
              - entity: select.{PREFIX}_forced_startup_under_low_soc_standby
                name: Forced Startup (Low SoC)
                icon: mdi:battery-alert
              - entity: number.{PREFIX}_battery_charging_start_power
                name: Charging Start Power
                icon: mdi:battery-charging-50
              - entity: number.{PREFIX}_battery_discharging_start_power
                name: Discharging Start Power
                icon: mdi:battery-discharging

  - title: Status & Diagnostics
    path: diagnostics
    icon: mdi:information-outline
    type: sections
    sections:
      - title: Device Identity
        cards:
          - type: entities
            title: Device Information
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_inverter_serial
                name: Serial Number
                icon: mdi:identifier
              - entity: sensor.{PREFIX}_sungrow_device_type_code
                name: Device Model
                icon: mdi:solar-power
              - entity: sensor.{PREFIX}_nominal_output_power
                name: Nominal Output Power
                icon: mdi:gauge
              - entity: sensor.{PREFIX}_output_type
                name: Output Type
                icon: mdi:transmission-tower

      - title: Protocol & Certification
        cards:
          - type: entities
            title: Protocol Version
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_protocol_version
                name: Protocol Version
                icon: mdi:file-document-outline
              - entity: sensor.{PREFIX}_protocol_version_raw
                name: Protocol Version Raw
                icon: mdi:hexadecimal
              - entity: sensor.{PREFIX}_certification_version_arm_software
                name: ARM Certification
                icon: mdi:certificate
              - entity: sensor.{PREFIX}_certification_version_dsp_software
                name: DSP Certification
                icon: mdi:certificate

      - title: Firmware Information
        cards:
          - type: entities
            title: Firmware Versions
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_inverter_firmware_info
                name: Inverter Firmware
                icon: mdi:chip
              - entity: sensor.{PREFIX}_communication_module_firmware_info
                name: Communication Module
                icon: mdi:chip
              - entity: sensor.{PREFIX}_battery_firmware_info
                name: Battery Firmware
                icon: mdi:chip

      - title: System Status
        cards:
          - type: entities
            title: System State
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_system_state
                name: System State
                icon: mdi:flash
              - entity: sensor.{PREFIX}_running_state
                name: Running State
                icon: mdi:state-machine
              - entity: sensor.{PREFIX}_inverter_temperature
                name: Inverter Temperature
                icon: mdi:thermometer

      - title: Master/Slave (Multi-Inverter)
        cards:
          - type: entities
            title: Cascade Configuration
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_master_slave_mode
                name: Master Slave Mode
                icon: mdi:connection
              - entity: sensor.{PREFIX}_master_slave_role
                name: Master Slave Role
                icon: mdi:connection
              - entity: sensor.{PREFIX}_slave_count
                name: Slave Count
                icon: mdi:numeric

      - title: Fault Indicators
        cards:
          - type: entities
            title: Battery Alarms & Faults
            show_header_toggle: false
            entities:
              - entity: sensor.{PREFIX}_battery_fault_raw
                name: Battery Fault
                icon: mdi:alert-circle
              - entity: sensor.{PREFIX}_battery_alarm_raw
                name: Battery Alarm
                icon: mdi:alert
              - entity: sensor.{PREFIX}_bms_alarm_raw
                name: BMS Alarm
                icon: mdi:alert
              - entity: sensor.{PREFIX}_bms_fault_1_raw
                name: BMS Fault 1
                icon: mdi:alert-circle
