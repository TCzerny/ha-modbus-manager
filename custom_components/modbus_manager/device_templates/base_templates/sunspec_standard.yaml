# SunSpec Standard Implementation
# Basierend auf den offiziellen SunSpec Alliance Spezifikationen
# https://sunspec.org/sunspec-specifications/

name: "SunSpec Standard"
type: "base_template"
version: 1
description: "SunSpec Alliance Standard-Implementierung mit Modellstruktur"

# SunSpec-Modellstruktur
# Jedes Modell hat eine ID, eine Länge und definierte Register
# Die tatsächlichen Adressen werden durch das Mapping bestimmt

# Common Model (1) - Allgemeine Geräteinformationen
common_model:
  id: 1
  length: 66
  registers:
    - name: "C_SunSpec_ID"
      offset: 0
      length: 2
      data_type: "uint32"
      description: "SunSpec Common Model ID (0x53756E53)"
      
    - name: "C_Model_ID"
      offset: 2
      data_type: "uint16"
      description: "SunSpec Model ID"
      
    - name: "C_Length"
      offset: 3
      data_type: "uint16"
      description: "Model Length"
      
    - name: "C_Manufacturer"
      offset: 4
      length: 16
      data_type: "string"
      description: "Manufacturer"
      
    - name: "C_Model"
      offset: 20
      length: 16
      data_type: "string"
      description: "Model"
      
    - name: "C_Serial"
      offset: 36
      length: 16
      data_type: "string"
      description: "Serial Number"
      
    - name: "C_Version"
      offset: 52
      length: 8
      data_type: "string"
      description: "Firmware Version"
      
    - name: "C_DeviceAddress"
      offset: 60
      data_type: "uint16"
      description: "Modbus Device Address"
      
    - name: "C_SunSpec_DID"
      offset: 61
      data_type: "uint16"
      description: "SunSpec Device ID"
      
    - name: "C_SunSpec_Length"
      offset: 62
      data_type: "uint16"
      description: "SunSpec Device Length"

# Inverter Model (101/102/103) - Wechselrichter-Daten
inverter_model:
  id: 101  # oder 102 für Split-Phase, 103 für Drei-Phasen
  length: 50
  registers:
    - name: "I_AC_Current"
      offset: 0
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "AC Total Current"
      
    - name: "I_AC_Current_A"
      offset: 1
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "AC Phase A Current"
      
    - name: "I_AC_Current_B"
      offset: 2
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "AC Phase B Current"
      
    - name: "I_AC_Current_C"
      offset: 3
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "AC Phase C Current"
      
    - name: "I_AC_Voltage_AB"
      offset: 4
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase AB"
      
    - name: "I_AC_Voltage_BC"
      offset: 5
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase BC"
      
    - name: "I_AC_Voltage_CA"
      offset: 6
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase CA"
      
    - name: "I_AC_Voltage_AN"
      offset: 7
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase A to N"
      
    - name: "I_AC_Voltage_BN"
      offset: 8
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase B to N"
      
    - name: "I_AC_Voltage_CN"
      offset: 9
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "AC Voltage Phase C to N"
      
    - name: "I_AC_Power"
      offset: 10
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      description: "AC Power"
      
    - name: "I_AC_Frequency"
      offset: 11
      data_type: "uint16"
      scale_factor: 0.01
      unit_of_measurement: "Hz"
      device_class: "frequency"
      state_class: "measurement"
      description: "AC Frequency"
      
    - name: "I_AC_VA"
      offset: 12
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "VA"
      state_class: "measurement"
      description: "AC Apparent Power"
      
    - name: "I_AC_VAR"
      offset: 13
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "var"
      state_class: "measurement"
      description: "AC Reactive Power"
      
    - name: "I_AC_PF"
      offset: 14
      data_type: "int16"
      scale_factor: 0.01
      unit_of_measurement: "%"
      device_class: "power_factor"
      state_class: "measurement"
      description: "AC Power Factor"
      
    - name: "I_AC_Energy_WH"
      offset: 15
      length: 2
      data_type: "uint32"
      scale_factor: 1
      unit_of_measurement: "Wh"
      device_class: "energy"
      state_class: "total_increasing"
      description: "AC Lifetime Energy Production"
      
    - name: "I_DC_Current"
      offset: 17
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "DC Current"
      
    - name: "I_DC_Voltage"
      offset: 18
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "DC Voltage"
      
    - name: "I_DC_Power"
      offset: 19
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      description: "DC Power"
      
    - name: "I_Temp_Sink"
      offset: 29
      data_type: "int16"
      scale_factor: 0.1
      unit_of_measurement: "°C"
      device_class: "temperature"
      state_class: "measurement"
      description: "Heat Sink Temperature"
      
    - name: "I_Status"
      offset: 35
      data_type: "uint16"
      description: "Operating State"
      map:
        1: "Off"
        2: "Sleeping"
        3: "Starting"
        4: "MPPT"
        5: "Throttled"
        6: "Shutting Down"
        7: "Fault"
        8: "Standby"
      
    - name: "I_Status_Vendor"
      offset: 36
      data_type: "uint16"
      description: "Vendor-Defined Operating State"

# Storage Model (124) - Speicher-Daten
storage_model:
  id: 124
  length: 24
  registers:
    - name: "S_ChaSt"
      offset: 0
      data_type: "uint16"
      description: "Battery Charge Status"
      map:
        1: "Off"
        2: "Empty"
        3: "Discharging"
        4: "Charging"
        5: "Full"
        6: "Holding"
        7: "Testing"
      
    - name: "S_SoC"
      offset: 1
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "%"
      device_class: "battery"
      state_class: "measurement"
      description: "Battery State of Charge"
      
    - name: "S_DoD"
      offset: 2
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "%"
      state_class: "measurement"
      description: "Battery Depth of Discharge"
      
    - name: "S_SoH"
      offset: 3
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "%"
      state_class: "measurement"
      description: "Battery State of Health"
      
    - name: "S_A"
      offset: 4
      data_type: "int16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "Battery Current"
      
    - name: "S_V"
      offset: 5
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "Battery Voltage"
      
    - name: "S_Tmp"
      offset: 6
      data_type: "int16"
      scale_factor: 0.1
      unit_of_measurement: "°C"
      device_class: "temperature"
      state_class: "measurement"
      description: "Battery Temperature"
      
    - name: "S_ChaPwr"
      offset: 7
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      description: "Battery Charge Power"
      
    - name: "S_ChAMax"
      offset: 8
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "Battery Maximum Charge Current"
      
    - name: "S_DiChAMax"
      offset: 9
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "Battery Maximum Discharge Current"
      
    - name: "S_DiChPwr"
      offset: 10
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      description: "Battery Discharge Power"
      
    - name: "S_WhCha"
      offset: 11
      length: 2
      data_type: "uint32"
      scale_factor: 1
      unit_of_measurement: "Wh"
      device_class: "energy"
      state_class: "total_increasing"
      description: "Battery Charge Energy"
      
    - name: "S_WhDiCha"
      offset: 13
      length: 2
      data_type: "uint32"
      scale_factor: 1
      unit_of_measurement: "Wh"
      device_class: "energy"
      state_class: "total_increasing"
      description: "Battery Discharge Energy"

# Meter Model (201/202/203) - Zähler-Daten
meter_model:
  id: 203  # 201 für Single-Phase, 202 für Split-Phase, 203 für Drei-Phasen
  length: 105
  registers:
    - name: "M_AC_Current"
      offset: 0
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "A"
      device_class: "current"
      state_class: "measurement"
      description: "Meter AC Total Current"
      
    - name: "M_AC_Voltage_LN"
      offset: 1
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "Meter AC Line to Neutral Voltage"
      
    - name: "M_AC_Voltage_LL"
      offset: 2
      data_type: "uint16"
      scale_factor: 0.1
      unit_of_measurement: "V"
      device_class: "voltage"
      state_class: "measurement"
      description: "Meter AC Line to Line Voltage"
      
    - name: "M_AC_Frequency"
      offset: 3
      data_type: "uint16"
      scale_factor: 0.01
      unit_of_measurement: "Hz"
      device_class: "frequency"
      state_class: "measurement"
      description: "Meter AC Frequency"
      
    - name: "M_AC_Power"
      offset: 4
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      description: "Meter AC Power"
      
    - name: "M_AC_VA"
      offset: 5
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "VA"
      state_class: "measurement"
      description: "Meter AC Apparent Power"
      
    - name: "M_AC_VAR"
      offset: 6
      data_type: "int16"
      scale_factor: 1
      unit_of_measurement: "var"
      state_class: "measurement"
      description: "Meter AC Reactive Power"
      
    - name: "M_AC_PF"
      offset: 7
      data_type: "int16"
      scale_factor: 0.01
      unit_of_measurement: "%"
      device_class: "power_factor"
      state_class: "measurement"
      description: "Meter AC Power Factor"
      
    - name: "M_Exported"
      offset: 8
      length: 2
      data_type: "uint32"
      scale_factor: 1
      unit_of_measurement: "Wh"
      device_class: "energy"
      state_class: "total_increasing"
      description: "Meter Exported Energy"
      
    - name: "M_Imported"
      offset: 10
      length: 2
      data_type: "uint32"
      scale_factor: 1
      unit_of_measurement: "Wh"
      device_class: "energy"
      state_class: "total_increasing"
      description: "Meter Imported Energy"
