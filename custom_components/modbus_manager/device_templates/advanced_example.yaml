# Erweitertes Template-Beispiel für Modbus Manager
# Demonstriert alle neuen Features aus modbus_connect
# Basierend auf: https://github.com/dmatscheko/modbus_connect

name: "Advanced Example Device"
description: "Template für erweiterte Modbus-Features"
manufacturer: "Example Manufacturer"
model: "Advanced Model"

sensors:
  # Basis-Sensor mit erweiterten Optionen
  - name: "Temperature Sensor"
    unique_id: "temp_sensor"
    device_address: 1
    address: 1000
    input_type: "input"
    data_type: "int16"
    count: 1
    scan_interval: 30
    precision: 1
    unit_of_measurement: "°C"
    device_class: "temperature"
    state_class: "measurement"
    scale: 0.1
    offset: -273.15  # Kelvin zu Celsius
    group: "environmental"

  # Float-Sensor (32-bit)
  - name: "Pressure Sensor"
    unique_id: "pressure_sensor"
    device_address: 1
    address: 1001
    input_type: "input"
    data_type: "float"
    count: 2
    scan_interval: 30
    precision: 2
    unit_of_measurement: "bar"
    device_class: "pressure"
    state_class: "measurement"
    scale: 1.0
    swap: true  # Register-Reihenfolge
    group: "environmental"

  # String-Sensor
  - name: "Device Name"
    unique_id: "device_name"
    device_address: 1
    address: 1003
    input_type: "input"
    data_type: "string"
    count: 5
    scan_interval: 3600
    precision: 0
    unit_of_measurement: ""
    device_class: null
    state_class: null
    scale: 1.0
    group: "identification"

  # Sensor mit Bit-Shift und Bit-Mask
  - name: "Status Register"
    unique_id: "status_register"
    device_address: 1
    address: 1008
    input_type: "input"
    data_type: "uint16"
    count: 1
    scan_interval: 10
    precision: 0
    unit_of_measurement: ""
    device_class: null
    state_class: "measurement"
    scale: 1.0
    shift_bits: 4  # 4 Bits nach rechts verschieben
    bits: 8        # Nur die unteren 8 Bits verwenden
    group: "status"

  # Sensor mit Enum-Mapping
  - name: "Operating Mode"
    unique_id: "operating_mode"
    device_address: 1
    address: 1009
    input_type: "input"
    data_type: "uint16"
    count: 1
    scan_interval: 30
    precision: 0
    unit_of_measurement: ""
    device_class: null
    state_class: "measurement"
    scale: 1.0
    map:
      0: "Off"
      1: "Standby"
      2: "Running"
      3: "Error"
      4: "Maintenance"
    group: "status"

  # Sensor mit Bit-Flags
  - name: "System Status"
    unique_id: "system_status"
    device_address: 1
    address: 1010
    input_type: "input"
    data_type: "uint16"
    count: 1
    scan_interval: 10
    precision: 0
    unit_of_measurement: ""
    device_class: null
    state_class: "measurement"
    scale: 1.0
    flags:
      0: "Power On"
      1: "Fan Active"
      2: "Pump Active"
      3: "Heating Active"
      4: "Cooling Active"
      5: "Alarm Active"
    group: "status"

  # Sensor mit Sum-Scale (mehrere Register)
  - name: "Total Energy"
    unique_id: "total_energy"
    device_address: 1
    address: 1011
    input_type: "input"
    data_type: "uint32"
    count: 2
    scan_interval: 300
    precision: 2
    unit_of_measurement: "kWh"
    device_class: "energy"
    state_class: "total"
    scale: 0.01
    sum_scale: [1, 10000]  # r1*1 + r2*10000
    swap: false
    group: "energy"

  # Number-Entity (read/write)
  - name: "Set Temperature"
    unique_id: "set_temperature"
    device_address: 1
    address: 2000
    input_type: "holding"
    data_type: "uint16"
    count: 1
    scan_interval: 30
    precision: 1
    unit_of_measurement: "°C"
    device_class: "temperature"
    state_class: "measurement"
    scale: 0.1
    control: "number"
    min_value: 10.0
    max_value: 50.0
    step: 0.5
    group: "control"

  # Select-Entity (read/write)
  - name: "Fan Speed"
    unique_id: "fan_speed"
    device_address: 1
    address: 2001
    input_type: "holding"
    data_type: "uint16"
    count: 1
    scan_interval: 30
    precision: 0
    unit_of_measurement: ""
    device_class: null
    state_class: "measurement"
    scale: 1.0
    control: "select"
    options:
      0: "Off"
      1: "Low"
      2: "Medium"
      3: "High"
      4: "Auto"
    group: "control"

  # Switch-Entity (read/write)
  - name: "Power Switch"
    unique_id: "power_switch"
    device_address: 1
    address: 2002
    input_type: "holding"
    data_type: "uint16"
    count: 1
    scan_interval: 10
    precision: 0
    unit_of_measurement: ""
    device_class: "switch"
    state_class: "measurement"
    scale: 1.0
    control: "switch"
    switch:
      "on": 1
      "off": 0
    group: "control"

  # Boolean-Sensor
  - name: "Alarm Status"
    unique_id: "alarm_status"
    device_address: 1
    address: 2003
    input_type: "input"
    data_type: "boolean"
    count: 1
    scan_interval: 5
    precision: 0
    unit_of_measurement: ""
    device_class: "problem"
    state_class: "measurement"
    scale: 1.0
    group: "alarms"

  # Sensor mit Multiplier
  - name: "Voltage Raw"
    unique_id: "voltage_raw"
    device_address: 1
    address: 2004
    input_type: "input"
    data_type: "uint16"
    count: 1
    scan_interval: 10
    precision: 1
    unit_of_measurement: "V"
    device_class: "voltage"
    state_class: "measurement"
    scale: 1.0
    multiplier: 0.01  # Raw-Wert * 0.01
    group: "electrical"

  # Sensor mit nie zurücksetzendem Total
  - name: "Lifetime Energy"
    unique_id: "lifetime_energy"
    device_address: 1
    address: 2005
    input_type: "input"
    data_type: "uint32"
    count: 2
    scan_interval: 3600
    precision: 2
    unit_of_measurement: "kWh"
    device_class: "energy"
    state_class: "total"
    scale: 0.01
    swap: true
    never_resets: true  # Wird nie zurückgesetzt
    group: "energy" 