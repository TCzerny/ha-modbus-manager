# Konfiguration für einphasige Sungrow SG-RT Serie
# Unterstützte Modelle:
# - SG3RT (3kW einphasig)
# - SG5RT (5kW einphasig)

registers:
  read:
    # Basis-Informationen
    - { name: "geraete_typ", address: 5000, type: "uint16", description: "Gerätetyp-Identifikation" }
    - { name: "seriennummer", address: 5002, type: "string", count: 10, description: "Seriennummer des Geräts" }
    - { name: "software_version", address: 5015, type: "uint16", scale: 0.01, description: "Software Version" }
    
    # Leistungsdaten
    - { name: "pv_leistung_gesamt", address: 5016, type: "uint32", unit_of_measurement: "W", device_class: "power", state_class: "measurement", scale: 1, swap: "word" }
    - { name: "pv1_leistung", address: 5018, type: "uint32", unit_of_measurement: "W", device_class: "power", state_class: "measurement", scale: 1, swap: "word" }
    - { name: "pv2_leistung", address: 5020, type: "uint32", unit_of_measurement: "W", device_class: "power", state_class: "measurement", scale: 1, swap: "word" }
    - { name: "ausgangsleistung_gesamt", address: 5026, type: "uint32", unit_of_measurement: "W", device_class: "power", state_class: "measurement", scale: 1, swap: "word" }
    - { name: "ausgangsleistung_l1", address: 5028, type: "uint32", unit_of_measurement: "W", device_class: "power", state_class: "measurement", scale: 1, swap: "word" }
    
    # Spannungen und Ströme PV
    - { name: "pv1_spannung", address: 5034, type: "uint16", unit_of_measurement: "V", device_class: "voltage", state_class: "measurement", scale: 0.1 }
    - { name: "pv1_strom", address: 5035, type: "uint16", unit_of_measurement: "A", device_class: "current", state_class: "measurement", scale: 0.1 }
    - { name: "pv2_spannung", address: 5036, type: "uint16", unit_of_measurement: "V", device_class: "voltage", state_class: "measurement", scale: 0.1 }
    - { name: "pv2_strom", address: 5037, type: "uint16", unit_of_measurement: "A", device_class: "current", state_class: "measurement", scale: 0.1 }
    
    # Netzparameter
    - { name: "netzfrequenz", address: 5042, type: "uint16", unit_of_measurement: "Hz", device_class: "frequency", state_class: "measurement", scale: 0.01 }
    - { name: "netzspannung_l1", address: 5043, type: "uint16", unit_of_measurement: "V", device_class: "voltage", state_class: "measurement", scale: 0.1 }
    - { name: "netzstrom_l1", address: 5046, type: "uint16", unit_of_measurement: "A", device_class: "current", state_class: "measurement", scale: 0.1 }
    - { name: "leistungsfaktor_l1", address: 5049, type: "int16", unit_of_measurement: "%", device_class: "power_factor", state_class: "measurement", scale: 0.001 }
    
    # Energiezähler
    - { name: "tagesertrag", address: 5052, type: "uint32", unit_of_measurement: "kWh", device_class: "energy", state_class: "total_increasing", scale: 0.1, swap: "word" }
    - { name: "gesamtertrag", address: 5054, type: "uint32", unit_of_measurement: "kWh", device_class: "energy", state_class: "total_increasing", scale: 0.1, swap: "word" }
    
    # Temperaturen
    - { name: "geraetetemperatur", address: 5056, type: "int16", unit_of_measurement: "°C", device_class: "temperature", state_class: "measurement", scale: 0.1 }
    - { name: "kuehlung_temperatur", address: 5057, type: "int16", unit_of_measurement: "°C", device_class: "temperature", state_class: "measurement", scale: 0.1 }
    
    # Status und Fehler
    - { name: "betriebsstatus", address: 5058, type: "uint16", description: "Aktueller Betriebsstatus" }
    - { name: "fehlercode", address: 5059, type: "uint16", description: "Aktueller Fehlercode" }
    - { name: "warncode", address: 5060, type: "uint16", description: "Aktueller Warncode" }

  write:
    # Steuerungsregister
    - { name: "geraet_ein_aus", address: 5100, type: "uint16", description: "Gerät ein/ausschalten (0: Aus, 1: Ein)" }
    - { name: "leistungsbegrenzung", address: 5102, type: "uint16", description: "Leistungsbegrenzung in %" }
    - { name: "leistungsfaktor_setpoint", address: 5103, type: "int16", description: "Leistungsfaktor Sollwert (-100 bis 100)" }
    - { name: "blindleistung_setpoint", address: 5104, type: "int16", description: "Blindleistung Sollwert in %" }

automations:
  - name: "Fehlerbenachrichtigung"
    trigger:
      platform: state
      entity_id: sensor.fehlercode
      from: "0"
    action:
      service: notify.notify
      data:
        title: "Wechselrichter Fehler"
        message: "Der Wechselrichter meldet einen Fehler (Code: {{ states('sensor.fehlercode') }})"

  - name: "Hohe Temperatur Warnung"
    trigger:
      platform: numeric_state
      entity_id: sensor.geraetetemperatur
      above: 75
    action:
      service: notify.notify
      data:
        title: "Wechselrichter Temperaturwarnung"
        message: "Die Gerätetemperatur ist über 75°C gestiegen!"